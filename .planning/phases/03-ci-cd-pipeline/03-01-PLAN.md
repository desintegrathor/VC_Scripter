---
phase: 03-ci-cd-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Self-hosted Windows runner is registered with GitHub repository"
    - "Runner service is running and can accept CI jobs"
    - "Runner has access to SCMP.exe compiler in repository"
  artifacts:
    - path: "C:\\actions-runner\\config.cmd"
      provides: "Runner configuration script"
      min_lines: 1
    - path: "C:\\actions-runner\\.runner"
      provides: "Runner registration file"
      contains: "agentId"
  key_links:
    - from: "GitHub Actions workflow"
      to: "Self-hosted runner"
      via: "runs-on: [self-hosted, windows, x64]"
      pattern: "runs-on.*self-hosted.*windows"
---

<objective>
Configure a self-hosted Windows GitHub Actions runner to enable CI/CD validation with access to the Windows-only SCMP.exe compiler.

Purpose: The original Vietcong compiler (SCMP.exe) is a 32-bit DOS-era Windows executable that cannot run on GitHub-hosted runners. A self-hosted runner on the existing Windows machine provides the required environment for automated validation.

Output: Running GitHub Actions runner service ready to execute workflow jobs with full repository access.
</objective>

<execution_context>
@C:\Users\flori\source\repos\VC_Scripter\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\flori\source\repos\VC_Scripter\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\flori\source\repos\VC_Scripter\.planning\PROJECT.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\ROADMAP.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\STATE.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\phases\03-ci-cd-pipeline\03-CONTEXT.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\phases\03-ci-cd-pipeline\03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Download GitHub Actions Runner</name>
  <files>C:\actions-runner\*</files>
  <action>
  Create runner directory and download the latest Windows x64 runner package:

  1. Create `C:\actions-runner` directory
  2. Download latest runner from GitHub releases: https://github.com/actions/runner/releases/latest
     - Look for pattern: `actions-runner-win-x64-*.zip`
     - Use PowerShell Invoke-WebRequest to download
  3. Extract ZIP to `C:\actions-runner`
  4. Verify extracted files include: config.cmd, run.cmd, svc.sh

  Reference: Research RESEARCH.md section "Runner Configuration Script"
  </action>
  <verify>
  PowerShell check:
  ```powershell
  Test-Path C:\actions-runner\config.cmd
  Test-Path C:\actions-runner\run.cmd
  ```
  Both should return True
  </verify>
  <done>Directory C:\actions-runner exists with runner binaries (config.cmd, run.cmd present)</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Generate GitHub runner registration token</action>
  <instructions>
  The runner registration requires a token that can only be generated through GitHub's web UI:

  1. Navigate to: https://github.com/[username]/VC_Scripter/settings/actions/runners/new
     (Replace [username] with actual GitHub username)
  2. Select "Windows" as operating system
  3. Copy the registration token from the "Configure" section
     - Token format: `A***************************` (long alphanumeric string)
     - Token is valid for 1 hour only
  4. Keep the page open - you'll need the full config command

  **What to copy:** The entire `--token` value from the configuration command shown in GitHub UI

  Example command shown by GitHub:
  ```
  .\config.cmd --url https://github.com/USER/VC_Scripter --token ABCD1234TOKEN5678
  ```

  You need: `ABCD1234TOKEN5678` (the token part)
  </instructions>
  <resume-signal>Paste the registration token (just the token, not the full command)</resume-signal>
</task>

<task type="auto">
  <name>Configure and Install Runner</name>
  <files>C:\actions-runner\.runner</files>
  <action>
  Configure the runner with GitHub repository and install as Windows service:

  1. Run configuration command:
     ```powershell
     cd C:\actions-runner
     .\config.cmd --url https://github.com/[username]/VC_Scripter --token [TOKEN_FROM_CHECKPOINT] --labels windows,x64 --runasservice --name "VC-Scripter-Windows-Runner"
     ```
     - Replace [username] with actual GitHub username from git remote
     - Replace [TOKEN_FROM_CHECKPOINT] with token from previous checkpoint
     - Accept defaults for runner group (press Enter)
     - Accept default work folder (press Enter)

  2. Install as Windows service:
     ```powershell
     .\svc.sh install
     ```

  3. Start the service:
     ```powershell
     .\svc.sh start
     ```

  4. Verify service is running:
     ```powershell
     .\svc.sh status
     ```

  Expected output: "status: Running"

  Reference: Research RESEARCH.md section "Runner Configuration Script" and GitHub Docs pattern
  </action>
  <verify>
  Check runner status:
  ```powershell
  cd C:\actions-runner
  .\svc.sh status
  ```
  Should show "status: Running"

  Check GitHub UI:
  Navigate to https://github.com/[username]/VC_Scripter/settings/actions/runners
  Should show runner with green "Idle" status
  </verify>
  <done>Runner appears in GitHub repository settings with "Idle" status, service is running</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Self-hosted Windows GitHub Actions runner installed and registered</what-built>
  <how-to-verify>
  1. Open browser: https://github.com/[username]/VC_Scripter/settings/actions/runners
     (Replace [username] with your GitHub username)

  2. Verify runner appears in list with:
     - Name: "VC-Scripter-Windows-Runner"
     - Status: Green dot with "Idle" (not "Offline")
     - Labels: "self-hosted", "Windows", "X64", "windows", "x64"

  3. Verify service is persistent:
     ```powershell
     cd C:\actions-runner
     .\svc.sh status
     ```
     Should show "status: Running"

  4. Test repository access - check runner has access to SCMP.exe:
     ```powershell
     cd C:\actions-runner\_work
     # Runner will create VC_Scripter directory on first job
     # For now, verify runner service account has read access to user's repository location
     Test-Path C:\Users\flori\source\repos\VC_Scripter\original-resources\compiler\SCMP.exe
     ```
     Should return True

  Expected state:
  - Runner shows as "Idle" in GitHub (ready for jobs)
  - Service is running and will auto-start on reboot
  - Compiler accessible from runner service account
  </how-to-verify>
  <resume-signal>Type "verified" if runner is online and idle, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Runner registered: Check GitHub repository settings shows active runner
2. Service running: PowerShell `.\svc.sh status` shows "Running"
3. Compiler accessible: SCMP.exe path accessible from runner service account
4. Labels configured: Runner has "self-hosted", "windows", "x64" labels for workflow targeting
</verification>

<success_criteria>
- Self-hosted runner appears in GitHub repository settings with "Idle" status
- Runner service is installed and running as Windows service
- Runner has "self-hosted", "windows", "x64" labels for workflow runs-on targeting
- Runner service account can access repository and SCMP.exe compiler
- Machine remains online to accept CI jobs
</success_criteria>

<output>
After completion, create `.planning/phases/03-ci-cd-pipeline/03-01-SUMMARY.md`
</output>
