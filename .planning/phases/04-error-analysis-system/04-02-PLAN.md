---
phase: 04-error-analysis-system
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - vcdecomp/gui/views/error_analysis_view.py
  - vcdecomp/gui/widgets/error_tree_widget.py
  - vcdecomp/gui/main_window.py
autonomous: true

must_haves:
  truths:
    - "User can view error patterns aggregated across test runs in GUI"
    - "Errors are displayed hierarchically by type with counts"
    - "User can expand error categories to see individual error details"
    - "Error analysis dock integrates with existing validation workflow"
  artifacts:
    - path: "vcdecomp/gui/views/error_analysis_view.py"
      provides: "Error analysis dock panel"
      exports: ["ErrorAnalysisPanel"]
      min_lines: 120
    - path: "vcdecomp/gui/widgets/error_tree_widget.py"
      provides: "Hierarchical error display widget"
      exports: ["ErrorTreeWidget"]
      min_lines: 180
    - path: "vcdecomp/gui/main_window.py"
      provides: "Error analysis dock integration"
      contains: "create_error_analysis_dock"
  key_links:
    - from: "vcdecomp/gui/widgets/error_tree_widget.py"
      to: "error_analyzer.ErrorPattern"
      via: "load_error_patterns method"
      pattern: "def load_error_patterns.*ErrorPattern"
    - from: "vcdecomp/gui/views/error_analysis_view.py"
      to: "ErrorTreeWidget"
      via: "widget composition"
      pattern: "self\\.error_tree = ErrorTreeWidget"
    - from: "vcdecomp/gui/main_window.py"
      to: "ErrorAnalysisPanel"
      via: "dock creation"
      pattern: "self\\.error_analysis_panel = ErrorAnalysisPanel"
---

<objective>
Create GUI for interactive error pattern exploration with hierarchical tree display.

Purpose: Satisfy ERROR-02 and ERROR-03 requirements by providing visual interface for understanding error distributions. Users can see "70% are syntax errors" at a glance and drill down to specific error instances for investigation.

Output: Error analysis dock panel with tree widget for hierarchical error display, integrated into main window alongside existing validation panel.
</objective>

<execution_context>
@C:\Users\flori\source\repos\VC_Scripter\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\flori\source\repos\VC_Scripter\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\flori\source\repos\VC_Scripter\.planning\PROJECT.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\ROADMAP.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\STATE.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\phases\04-error-analysis-system\04-CONTEXT.md
@C:\Users\flori\source\repos\VC_Scripter\.planning\phases\04-error-analysis-system\04-RESEARCH.md

# Reference existing patterns
@C:\Users\flori\source\repos\VC_Scripter\vcdecomp\gui\widgets\difference_widgets.py
@C:\Users\flori\source\repos\VC_Scripter\vcdecomp\gui\views\validation_view.py
@C:\Users\flori\source\repos\VC_Scripter\vcdecomp\gui\main_window.py
</context>

<tasks>

<task type="auto">
  <name>Create ErrorTreeWidget for hierarchical error display</name>
  <files>vcdecomp/gui/widgets/error_tree_widget.py</files>
  <action>
Create vcdecomp/gui/widgets/error_tree_widget.py following DifferenceTreeView pattern:

1. **Class structure:**
   - Inherit from QTreeWidget (same as DifferenceTreeView)
   - Set font to Consolas 9pt (monospace for alignment)
   - Headers: ["Error Type", "Count", "Percentage", "Examples"]
   - Column widths: [300, 80, 100, 400]
   - Enable alternating row colors for readability

2. **load_error_patterns() method:**
   - Input: List[ErrorPattern] from ErrorAnalyzer.analyze_batch_results()
   - Clear existing tree items
   - Create top-level items for each error type (syntax, semantic, type, include, other)
   - Display: "SYNTAX ERRORS (142)" with 70.5% badge
   - Color coding:
     - syntax: light red background (#ffe6e6)
     - semantic: light yellow background (#fffacd)
     - type: light blue background (#e6f2ff)
     - include: light gray background (#f0f0f0)
     - other: white background
   - Make top-level items expandable

3. **Child items for examples:**
   - Under each error type node, add child items for first 5 examples
   - Display: file:line - message
   - Store CompilationError object in item data (Qt.UserRole) for detail view
   - Truncate long messages to 100 chars with "..."

4. **Signals:**
   - error_selected = pyqtSignal(object)  # CompilationError
   - Emit when user selects an error item (not category header)

5. **Selection handling:**
   - Connect itemSelectionChanged to _on_selection_changed
   - Emit error_selected signal with CompilationError object

6. **Empty state:**
   - If no patterns provided, show "No errors to display" placeholder item

**Follow existing patterns:**
- Same import structure as difference_widgets.py
- Same color scheme approach (QBrush, QColor)
- Same item data storage pattern (_item_to_error dict)
- Use QFont.Weight.Bold for category headers
  </action>
  <verify>
python -c "from vcdecomp.gui.widgets.error_tree_widget import ErrorTreeWidget; print('Widget imports successfully')"
  </verify>
  <done>
ErrorTreeWidget class defined, load_error_patterns method implemented, signals defined, color coding applied, follows DifferenceTreeView pattern
  </done>
</task>

<task type="auto">
  <name>Create ErrorAnalysisPanel dock view</name>
  <files>vcdecomp/gui/views/error_analysis_view.py</files>
  <action>
Create vcdecomp/gui/views/error_analysis_view.py following ValidationPanel pattern:

1. **Class structure:**
   - Inherit from QWidget (same as ValidationPanel)
   - Vertical layout with sections:
     - Title label: "Error Analysis"
     - Stats summary (QLabel): "Analyzed 15 validation results, 142 total errors"
     - ErrorTreeWidget (main content)
     - Refresh button (QPushButton)

2. **__init__ method:**
   - Create ErrorTreeWidget instance
   - Create summary label (initially empty)
   - Create "Analyze Test Results" button
   - Layout widgets vertically

3. **load_validation_results() method:**
   - Input: List[ValidationResult]
   - Use ErrorAnalyzer to aggregate errors
   - Update summary label with total count
   - Call error_tree.load_error_patterns(patterns)
   - If no results, show "No results to analyze" in summary

4. **clear() method:**
   - Clear error tree
   - Reset summary label
   - Used when starting new analysis

5. **Signal connections:**
   - Connect error_tree.error_selected to _on_error_selected
   - Emit detail_requested signal (for future side-by-side view integration)

6. **Styling:**
   - Use QGroupBox for stats summary section
   - Match ValidationPanel styling (consistent with existing GUI)
   - Use same fonts and spacing

**Integration points:**
- Import ErrorAnalyzer from vcdecomp.validation.error_analyzer
- Import ErrorTreeWidget from vcdecomp.gui.widgets.error_tree_widget
- Import ValidationResult from vcdecomp.validation.validation_types
  </action>
  <verify>
python -c "from vcdecomp.gui.views.error_analysis_view import ErrorAnalysisPanel; print('Panel imports successfully')"
  </verify>
  <done>
ErrorAnalysisPanel class defined, load_validation_results method implemented, ErrorTreeWidget integrated, clear method works, follows ValidationPanel pattern
  </done>
</task>

<task type="auto">
  <name>Integrate ErrorAnalysisPanel into main window</name>
  <files>vcdecomp/gui/main_window.py</files>
  <action>
Update vcdecomp/gui/main_window.py to add error analysis dock:

1. **Add import:**
   - from vcdecomp.gui.views.error_analysis_view import ErrorAnalysisPanel

2. **Create dock in create_docks() method:**
   - After validation_dock creation (around line where validation_panel is created)
   - Create error_analysis_panel = ErrorAnalysisPanel(self)
   - Create error_analysis_dock = QDockWidget("Error Analysis", self)
   - Set error_analysis_dock.setWidget(error_analysis_panel)
   - Add dock: self.addDockWidget(Qt.DockWidgetArea.RightDockWidgetArea, error_analysis_dock)
   - Initially hidden (don't show by default - user opens when needed)
   - Store reference: self.error_analysis_panel = error_analysis_panel

3. **Add menu item in View menu:**
   - After "Validation Panel" toggle action
   - Add "Error Analysis Panel" toggle action
   - Connect to dock.setVisible(checked)
   - Use dock.toggleViewAction() for automatic sync

4. **Connect to validation workflow:**
   - When validation completes (in ValidationPanel), make results available
   - User can manually trigger analysis via "Analyze" button in ErrorAnalysisPanel
   - Do NOT auto-populate (diagnostic tool, not real-time monitoring)

**What to avoid:**
- Do NOT automatically show error analysis dock (clutter)
- Do NOT auto-populate on every validation (one-time diagnostic use)
- Do NOT modify existing validation workflow
- Only add UI integration, no behavior changes
  </action>
  <verify>
python -c "from vcdecomp.gui.main_window import VCDecompilerMainWindow; print('Main window imports successfully')"
  </verify>
  <done>
Main window imports successfully, error_analysis_panel attribute exists, dock created in RightDockWidgetArea, View menu has toggle action, dock initially hidden
  </done>
</task>

</tasks>

<verification>
1. GUI launches without errors: `python -m vcdecomp gui`
2. View menu shows "Error Analysis Panel" toggle option
3. Clicking toggle shows/hides error analysis dock
4. ErrorTreeWidget displays placeholder when no data loaded
5. No import errors or missing dependencies
</verification>

<success_criteria>
- ERROR-02 partially satisfied: Error patterns displayed visually with percentages
- ERROR-03 partially satisfied: Interactive tree view for exploring error categories
- Error analysis dock integrates seamlessly with existing GUI
- Follows established patterns (DifferenceTreeView, ValidationPanel)
- User can toggle visibility via View menu
- Widget hierarchy: ErrorTreeWidget shows categories -> examples
</success_criteria>

<output>
After completion, create `.planning/phases/04-error-analysis-system/04-02-SUMMARY.md`
</output>
